(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{28:function(e,t,a){e.exports=a(58)},33:function(e,t,a){},51:function(e,t){function a(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}a.keys=function(){return[]},a.resolve=a,e.exports=a,a.id=51},52:function(e,t,a){},58:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),r=a(24),i=a.n(r),l=(a(33),a(2)),c=a(3),o=a(6),u=a(5),d=a(4),m=a(25),p=a.n(m),h=a(8),v=a.n(h),f=a(10),k=a.n(f),g=a(26),b=(a(52),{protocol:"https",hostname:"old-copy-tasksystem-9f16a052b963.herokuapp.com",colorScale:["","#f7cbd7","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#bde4e5","#dbdbdb"]});b.httpaddr=b.protocol+"://"+b.hostname,b.wsaddr="wss://"+b.hostname;var y=b,E=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).state={serverAlive:!1},n.ping=n.ping.bind(Object(o.a)(n)),n}return Object(c.a)(a,[{key:"componentDidMount",value:function(){this.timer=setInterval(this.ping,3e4),this.ping()}},{key:"componentWillUnmount",value:function(){clearInterval(this.timer)}},{key:"ping",value:function(){var e=this;v.a.get(y.httpaddr+"/").then((function(t){e.setState({serverAlive:!0})})).catch((function(t){t.response?e.setState({serverAlive:!0}):e.setState({serverAlive:!1})}))}},{key:"render",value:function(){var e=this.state.serverAlive?"Online":"Offline";return s.a.createElement("div",{className:"ServerStatus"},s.a.createElement("label",null,"Server status:"),s.a.createElement("div",{className:"status-icon "+(this.state.serverAlive?"server-online":"server-offline")}),s.a.createElement("p",null,e))}}]),a}(n.Component),x=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(){return Object(l.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){return s.a.createElement("div",{className:"spinner"},s.a.createElement("div",{className:"spinner-stage-1"}),s.a.createElement("div",{className:"spinner-stage-2"}),s.a.createElement("div",{className:"spinner-stage-3"}),s.a.createElement("div",{className:"spinner-stage-4"}),s.a.createElement("div",{className:"spinner-stage-5"}),s.a.createElement("div",{className:"spinner-stage-6"}),s.a.createElement("div",{className:"spinner-stage-7"}),s.a.createElement("div",{className:"spinner-stage-8"}),s.a.createElement("div",{className:"spinner-stage-9"}),s.a.createElement("div",{className:"spinner-stage-10"}),s.a.createElement("div",{className:"spinner-stage-11"}),s.a.createElement("div",{className:"spinner-stage-12"}))}}]),a}(n.Component),w=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(){return Object(l.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){return s.a.createElement("div",{className:"LoadingScreen"},s.a.createElement(x,null),s.a.createElement("p",{className:"spinner-text"},"Loading..."))}}]),a}(n.Component),T=a(1),O=a.n(T),N=a(27),S=a.n(N),j=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(){return Object(l.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=new S.a(y.colorScale[this.props.task.category]),t={backgroundColor:e,borderColor:e.darken(.2)};return s.a.createElement("div",{className:"Task",style:t},s.a.createElement("div",{className:"task-info"},s.a.createElement("span",{className:"code"},this.props.task.code),s.a.createElement("span",{className:"desc"},this.props.task.desc)),s.a.createElement("div",{className:"time-info"},s.a.createElement("time",{className:"day"},this.props.task.date.format("ddd")),s.a.createElement("time",{className:"time"},this.props.task.starttime.format("HH:mm")),"\u2013",s.a.createElement("time",{className:"time"},this.props.task.endtime.format("HH:mm"))),s.a.createElement("p",{className:"tooltip"},this.props.tooltipText))}}]),a}(n.Component),C=a(9),A=["Sat","Sun","Mon","Tue","Wed","Thu","Fri"];function L(e){var t=e.clone().startOf("day");return e.diff(t,"hours",!0)}var B=18,D=5,_=45,F=5,H=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).createCalendar=n.createCalendar.bind(Object(o.a)(n)),n.updateCalendar=n.updateCalendar.bind(Object(o.a)(n)),n}return Object(c.a)(a,[{key:"componentDidMount",value:function(){this.createCalendar(),this.updateCalendar()}},{key:"componentDidUpdate",value:function(){this.updateCalendar()}},{key:"createCalendar",value:function(){var e=C.e(this.svgNode);this.plot=e.append("g").attr("class","cal"),this.dayScale=C.c().domain(A),this.timeScale=C.d().domain([7,22]),this.timeAxis=e.append("g").attr("class","time axis"),this.dateAxis=e.append("g").attr("class","date axis")}},{key:"updateCalendar",value:function(){var e=this,t=C.e(this.svgNode),a=this.props.size[0]-_-F,n=this.props.size[1]-B-D;this.dayScale.range([0,a]),this.timeScale.range([0,n]);var s=C.b(this.dayScale);this.dateAxis.attr("transform","translate("+_+","+B+")").call(s);var r=C.a(this.timeScale);this.timeAxis.attr("transform","translate("+_+","+B+")").call(r),this.plot.attr("transform","translate("+_+","+B+")"),t.selectAll(".day.label").data(A).attr("x",(function(t){return e.dayScale(t)})).attr("y",14);var i=this.plot.selectAll(".task").data(e.props.tasks,(function(e){return e.code})),l=i.enter().append("g").attr("class","task");l.append("rect");var c=l.append("foreignObject").append("xhtml:body").style("background-color","rgba(0,0,0,0)");c.append("xhtml:p").attr("class","taskdesc"),c.append("xhtml:p").attr("class","tooltip").style("border","0.5px solid white").style("border-radius","2px").style("background-color","white").text("remove"),(i=this.plot.selectAll(".task").data(e.props.tasks,(function(e){return e.code}))).attr("transform",(function(t){return"translate("+e.dayScale(t.date.format("ddd"))+","+e.timeScale(L(t.starttime))+")"})).on("click",(function(t){if(!t.is_sticky)return e.props.clickHandler(t)})),i.selectAll("rect").attr("x",0).attr("y",0).attr("width",(function(t){return e.dayScale.bandwidth()})).attr("height",(function(t){return e.timeScale(L(t.endtime))-e.timeScale(L(t.starttime))})).attr("fill",(function(e){return y.colorScale[e.category]})),i.selectAll("foreignObject").attr("x",0).attr("y",0).attr("width",(function(t){return e.dayScale.bandwidth()})).attr("height",(function(t){return e.timeScale(L(t.endtime))-e.timeScale(L(t.starttime))})),i.selectAll("body").classed("clickable",(function(e){return!e.is_sticky})),i.selectAll(".taskdesc").attr("style",(function(t){return"height:"+(e.timeScale(L(t.endtime))-e.timeScale(L(t.starttime))-5)+"px"})).text((function(e){return e.code+": "+e.desc})),i.exit().remove()}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:"CalendarView"},s.a.createElement("svg",{ref:function(t){return e.svgNode=t},width:this.props.size[0],height:this.props.size[1]}))}}]),a}(n.Component),M=function(e){return k.a.duration(e.endtime.diff(e.starttime)).asHours()},z={1:[0,14],2:[0,14],3:[0,10],4:[0,14],5:[0,10],6:[0,6],7:[0,1]},U={};O.a.keys(z).forEach((function(e){U[e]=[]}));var q=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(){return Object(l.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=O.a.values(this.props.tasks.val()),t=O.a.groupBy(O.a.values(e),"category");t=Object.assign({},U,t);var a=O.a.mapValues(t,(function(e){return O.a.reduce(e,(function(e,t){return e+M(t)}),0)})),n=O.a.sortBy(O.a.keys(z)).map((function(e){var t="";return(a[e]<z[e][0]||a[e]>z[e][1])&&(t+=" violation"),s.a.createElement("li",{className:t,key:e},s.a.createElement("label",null,"Category ",e),s.a.createElement("div",{className:"count"},z[e][0]," \u2264 ",a[e].toFixed(2)," \u2264"," ",z[e][1]))})),r=O.a.reduce(e,(function(e,t){return e+M(t)}),0);return s.a.createElement("div",{className:"LimitPanel"},s.a.createElement("h2",null,"Limits"),s.a.createElement("p",{className:"info-text"},"Please pay attention to any red lines. If you take too many tasks of a certain type then the SV chairs will remove those at random."),s.a.createElement("ul",null,n,s.a.createElement("li",{className:r<14?"violation":""},s.a.createElement("label",null,"Total hours"),s.a.createElement("div",{className:"count"},r.toFixed(2)," / ",14))))}}]),a}(n.Component),I=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(){return Object(l.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){var e=this,t=O.a.sortBy(O.a.values(this.props.tasks.val()),"starttime").map((function(t,a){var n=null,r="",i="task";return t.is_sticky||(n=e.props.clickHandler.bind(this,t),r="remove",i+=" clickable"),s.a.createElement("li",{key:a,onClick:n,className:i},s.a.createElement(j,{task:t,tooltipText:r}))}));return s.a.createElement("div",{className:"SelectedTaskList"},s.a.createElement("h1",null,"Selected Tasks"),s.a.createElement(q,{tasks:e.props.tasks}),s.a.createElement(H,{size:[518,498],clickHandler:e.props.clickHandler,tasks:O.a.values(e.props.tasks.val())}),s.a.createElement("ul",null,t))}}]),a}(n.Component),W={Sat:1,Sun:2,Mon:3,Tue:4,Wed:5,Thu:6,Fri:7},P=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).state={showConflicts:!1,groupBy:"category",filterText:""},n.filterSearched=n.filterSearched.bind(Object(o.a)(n)),n.filterAvailable=n.filterAvailable.bind(Object(o.a)(n)),n.groupTasks=n.groupTasks.bind(Object(o.a)(n)),n}return Object(c.a)(a,[{key:"showAllTasks",value:function(e){this.setState({showConflicts:!0})}},{key:"showUnconflictingTasks",value:function(e){this.setState({showConflicts:!1})}},{key:"updateGroup",value:function(e){this.setState({groupBy:e.target.value})}},{key:"updateTextFilter",value:function(e){this.setState({filterText:e.target.value.trim()})}},{key:"filterSearched",value:function(e){if(this.state.filterText){var t=new RegExp(this.state.filterText,"i");e=O.a.filter(e,(function(e,a){return t.test(e.code+" "+e.desc)}))}return e}},{key:"filterAvailable",value:function(e){if(!this.state.showConflicts){var t=O.a.values(this.props.selectedTasks.val());O.a.keys(e).forEach((function(a){var n=e[a];O.a.findIndex(t,(function(e){return Math.max(n.starttime,e.starttime)<Math.min(n.endtime,e.endtime)}))>=0&&O.a.unset(e,a)}))}return e}},{key:"groupTasks",value:function(e){var t,a=O.a.values(e);switch(this.state.groupBy){case"date":t=O.a.groupBy(a,(function(e){return e.date.format("ddd")}));break;case"category":t=O.a.groupBy(a,(function(e){return"Category "+e.category}));break;default:t=O.a.groupBy(a,this.state.groupBy)}return t}},{key:"render",value:function(){var e=this,t=this.filterAvailable(Object.assign({},this.props.tasks.val()));t=this.filterSearched(t);var a=this.groupTasks(t),n=O.a.keys(a),r=(n="date"===e.state.groupBy?O.a.sortBy(n,(function(e){return W[e]})):O.a.sortBy(n)).map((function(t,n){var r=t,i=O.a.sortBy(a[t],"code").map((function(t,a){var n=null,r="",i="task";return t.is_sticky||(n=e.props.clickHandler.bind(this,t),r="add",i+=" clickable"),s.a.createElement("li",{key:a,onClick:n,className:i},s.a.createElement(j,{task:t,tooltipText:r}))}));return s.a.createElement("li",{className:"taskgroup",key:n},s.a.createElement("h2",{className:"category"},r),s.a.createElement("ul",null,i))}));return s.a.createElement("div",{className:"AvailableTaskList"},s.a.createElement("h1",null,"Available Tasks"),s.a.createElement("div",{className:"view-controls"},s.a.createElement("div",{className:"taskfilter"},s.a.createElement("h3",null,"Filter by"),s.a.createElement("input",{type:"radio",name:"taskfilter",id:"taskfilter-all",checked:e.state.showConflicts,onChange:e.showAllTasks.bind(this),value:"all"}),s.a.createElement("label",{htmlFor:"taskfilter-all"},"All"),s.a.createElement("input",{type:"radio",name:"taskfilter",id:"taskfilter-noconflict",checked:!e.state.showConflicts,onChange:e.showUnconflictingTasks.bind(this),value:"noconflict"}),s.a.createElement("label",{htmlFor:"taskfilter-noconflict"},"Non-overlapping")),s.a.createElement("div",{className:"taskgrouper"},s.a.createElement("h3",null,"Group by"),s.a.createElement("input",{type:"radio",name:"taskgroup",id:"taskgroup-category",checked:"category"===e.state.groupBy,onChange:e.updateGroup.bind(this),value:"category"}),s.a.createElement("label",{htmlFor:"taskgroup-category"},"Category"),s.a.createElement("input",{type:"radio",name:"taskgroup",id:"taskgroup-date",checked:"date"===e.state.groupBy,onChange:e.updateGroup.bind(this),value:"date"}),s.a.createElement("label",{htmlFor:"taskgroup-date"},"Date")),s.a.createElement("input",{type:"text",id:"search-text",className:"task-textfilter",placeholder:"Search tasks",onChange:e.updateTextFilter.bind(this)})),s.a.createElement("ul",{className:"availabletasks"},r))}}]),a}(n.Component),G=s.a.createElement("div",{className:"SavingPanel"},s.a.createElement("label",{className:"message"},"Saving..."),s.a.createElement("div",{className:"loading-spinner"})),V=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).state={message:null,requests:0},n}return Object(c.a)(a,[{key:"render",value:function(){var e,t=this;return this.state.message&&(e=s.a.createElement("div",{className:"alert alert-warning"},s.a.createElement("p",null,s.a.createElement("strong",null,"Note:"),this.state.message))),s.a.createElement("div",{className:"TaskSelector"},e,this.state.requests>0?G:null,s.a.createElement("div",{className:"ui"},s.a.createElement(P,{clickHandler:function(e,a){var n=O.a.values(t.props.selectedTasks.val()),s=[];O.a.findIndex(n,(function(t){t.code,t.desc;var a=Math.max(e.starttime,t.starttime),n=Math.min(e.endtime,t.endtime);return a<n&&s.push(t),a<n}));if(s.length>0){var r=" Overlap with tasks: ";return s.forEach((function(e){r+=" ".concat(e.code," - ").concat(e.desc)})),r+=". Remove these tasks before selecting this task.",void t.setState({message:r})}var i={headers:{Authorization:"Token "+t.props.authToken.val()}};v.a.put(y.httpaddr+"/select_task/"+e.code,{},i).then((function(a){var n={};n[e.code]=e,t.props.selectedTasks.merge(n),t.props.availableTasks[e.code]&&t.props.availableTasks[e.code].destroy(),t.setState({message:null})})).catch((function(a){var n="Server error";if(console.log("err: "+a.response),a.response&&a.response.data)switch(a.response.data.code){case"task_taken":n=e.desc+" already taken";break;default:n=a.response.data.code}t.setState({message:n})})).then((function(){t.setState({requests:t.state.requests-1})}));t.setState({requests:t.state.requests+1})},tasks:this.props.availableTasks,selectedTasks:this.props.selectedTasks}),s.a.createElement(I,{clickHandler:function(e){var a={headers:{Authorization:"Token "+t.props.authToken.val()}};v.a.delete(y.httpaddr+"/select_task/"+e.code,a).then((function(a){var n={};n[e.code]=e,t.props.availableTasks.merge(n),t.props.selectedTasks[e.code].destroy(),t.setState({message:null})})).catch((function(a){var n="Server error";if(a.response&&a.response.data)switch(a.response.data.code){case"task_not_removable":n=e.desc+" cannot be removed";break;default:n=a.response.data.code}t.setState({message:n})})).then((function(){t.setState({requests:t.state.requests-1})}));t.setState({requests:t.state.requests+1})},tasks:this.props.selectedTasks})))}}]),a}(n.Component),R=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).processLogin=n.processLogin.bind(Object(o.a)(n)),n.state={isLoading:!1,loginErrors:[]},n}return Object(c.a)(a,[{key:"processLogin",value:function(e){var t=this;e.preventDefault();var a={username:e.target.username.value,password:e.target.password.value};t.setState({isLoading:!0}),v.a.post(y.httpaddr+"/api-token-auth/",a).then((function(e){t.setState({loginErrors:[],isLoading:!1}),t.props.cortex.merge({status:"loading",authToken:e.data.token})})).catch((function(e){console.log(e);var a=e.response.data,n=O.a.keys(a).map((function(e){return a[e].map((function(t){return e+": "+t}))}));n=O.a.flattenDeep(n),t.setState({loginErrors:n,isLoading:!1})}))}},{key:"render",value:function(){var e=this.state.loginErrors.map((function(e,t){return s.a.createElement("li",{key:t},e)}));if(e.length>0)var t=s.a.createElement("div",{className:"alert alert-error"},s.a.createElement("p",null,s.a.createElement("strong",null,"Login error")),s.a.createElement("ul",null,e));if(this.state.isLoading)var a=s.a.createElement("div",{className:"loading-spinner"});return s.a.createElement("div",{className:"LoginScreen"},s.a.createElement("h1",null,"Please log in"),t,s.a.createElement("form",{onSubmit:this.processLogin},s.a.createElement("label",null,"Username: ",s.a.createElement("input",{type:"text",name:"username",className:"needMargin"})),s.a.createElement("label",null,"Password: ",s.a.createElement("input",{type:"password",name:"password",className:"needMargin"})),s.a.createElement("button",{type:"submit",disabled:this.state.isLoading},"Login ",a)))}}]),a}(n.Component),J=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(){return Object(l.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"render",value:function(){return s.a.createElement("div",{className:"ErrorScreen"},s.a.createElement("p",{className:"alert alert-error"},s.a.createElement("strong",null,"Error")," ",this.props.err))}}]),a}(n.Component);function K(e){e.starttime=k()(e.date+" "+e.starttime),e.endtime=k()(e.date+" "+e.endtime),e.date=k()(e.date)}var $=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;Object(l.a)(this,a),n=t.call(this,e);var s=new p.a({status:"unauthorized",authToken:null,errText:null,availableTasks:{},selectedTasks:{}},(function(e){n.setState({cortex:e})}));return n.state={cortex:s},n.wsConnect=n.wsConnect.bind(Object(o.a)(n)),n}return Object(c.a)(a,[{key:"wsConnect",value:function(){var e=this,t=new g.WebSocketBridge;t.connect(y.wsaddr),t.addEventListener("message",(function(t){var a=t.data;switch(a.action){case"remove":e.state.cortex.availableTasks.hasKey(a.task.code)&&e.state.cortex.availableTasks[a.task.code].destroy();break;case"add":var n=a.task;K(n);var s={};s[n.code]=n,e.state.cortex.availableTasks.merge(s);break;default:console.warn("Unknown action: "+a.action)}}))}},{key:"loadInitialData",value:function(){var e=this,t={headers:{Authorization:"Token "+this.state.cortex.authToken.val()}},a=v.a.get(y.httpaddr+"/available_tasks/",t),n=v.a.get(y.httpaddr+"/selected_tasks/",t);v.a.all([a,n]).then(v.a.spread((function(t,a){var n={},s={};a.data.forEach((function(e){K(e),n[e.code]=e})),t.data.forEach((function(e){K(e),s[e.code]=e})),e.state.cortex.merge({status:"loaded",availableTasks:s,selectedTasks:n})}))).catch((function(t){t.response?401===t.response.status||403===t.response.status?e.state.cortex.merge({status:"unauthorized",authToken:null}):e.state.cortex.merge({status:"error",errText:t.response.statusText}):e.state.cortex.merge({status:"error",errText:"server error"})}))}},{key:"componentDidMount",value:function(){"loading"===this.state.cortex.status.val()&&null!==this.state.cortex.authToken.val()&&(this.wsConnect(),this.loadInitialData())}},{key:"componentDidUpdate",value:function(){"loading"===this.state.cortex.status.val()&&null!==this.state.cortex.authToken.val()&&(this.wsConnect(),this.loadInitialData())}},{key:"render",value:function(){var e;switch(this.state.cortex.status.getValue()){case"loading":e=s.a.createElement(w,null);break;case"unauthorized":e=s.a.createElement(R,{cortex:this.state.cortex});break;case"error":e=s.a.createElement(J,{err:this.state.cortex.errText.val()});break;case"loaded":e=s.a.createElement(V,{authToken:this.state.cortex.authToken,availableTasks:this.state.cortex.availableTasks,selectedTasks:this.state.cortex.selectedTasks});break;default:e=s.a.createElement(J,{err:"Unknown state: "+this.state.cortex.status.val()})}return s.a.createElement("div",{className:"App"},s.a.createElement(E,null),s.a.createElement("hr",null),e)}}]),a}(n.Component),Q=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function X(e){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var t=e.installing;t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}})).catch((function(e){console.error("Error during service worker registration:",e)}))}i.a.render(s.a.createElement($,null),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL("/tasksystem",window.location).origin!==window.location.origin)return;window.addEventListener("load",(function(){var e="".concat("/tasksystem","/service-worker.js");Q?function(e){fetch(e).then((function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):X(e)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(e):X(e)}))}}()}},[[28,1,2]]]);
//# sourceMappingURL=main.292c1acd.chunk.js.map